name: Validate StreamElements Widget

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  validate:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: Install tools
        run: |
          npm install --save-dev prettier@latest eslint@latest htmlhint@latest stylelint@latest

      - name: Check formatting with Prettier
        run: |
          if [ "${{ github.event_name }}" = "pull_request" ]; then
            npx prettier --check "**/*.{js,html,css,json,md}" --ignore-path .prettierignore
          else
            npx prettier --check "**/*.{js,html,css,json,md}" --ignore-path .prettierignore || echo "⚠️ Prettier found issues (non-blocking on push)"
          fi

      - name: Lint JavaScript
        run: |
          npx eslint phasmophobia_evidence_tracker/widget.js --max-warnings=0 || exit 1

      - name: Validate HTML
        run: |
          npx htmlhint "phasmophobia_evidence_tracker/widget.html"

      - name: Validate CSS
        run: |
          npx stylelint "phasmophobia_evidence_tracker/widget.css"

      - name: Validate widget.json syntax
        run: |
          node -e "JSON.parse(require('fs').readFileSync('phasmophobia_evidence_tracker/widget.json','utf8'))"
