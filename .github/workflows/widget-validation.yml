name: Validate StreamElements Widget

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  validate:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20

      # 1️⃣ Install linters and validators
      - name: Install tools
        run: |
          npm install -g eslint prettier htmlhint stylelint

      # 2️⃣ Run Prettier check (formatting)
      - name: Check formatting with Prettier
        run: |
          npx prettier --check "**/*.{js,html,css,json,md}"

      # 3️⃣ Run ESLint for JS
      - name: Lint JavaScript
        run: |
          npx eslint phasmophobia_evidence_tracker/widget.js --max-warnings=0 || exit 1

      # 4️⃣ Validate HTML
      - name: Validate HTML
        run: |
          npx htmlhint "phasmophobia_evidence_tracker/widget.html"

      # 5️⃣ Validate CSS
      - name: Validate CSS
        run: |
          npx stylelint "phasmophobia_evidence_tracker/widget.css"

      # 6️⃣ Optionally run a syntax check on JSON config
      - name: Validate widget.json syntax
        run: |
          node -e "JSON.parse(require('fs').readFileSync('phasmophobia_evidence_tracker/widget.json','utf8'))"
